<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>卓越物流管理系统</title>
<link rel="stylesheet" href="css/bootstrap.css" />
<link rel="stylesheet" href="css/css.css" />
<script type="text/javascript" src="js/jquery1.9.0.min.js"></script>
<script type="text/javascript" src="js/bootstrap.min.js"></script>
<script type="text/javascript" src="js/sdmenu.js"></script>
<script type="text/javascript" src="js/laydate/laydate.js"></script>

</head>

<body>
<div class="header">
	 <div class="logo"><img  src="img/网站大标题0.png" /></div>
     
				<div class="header-right">
                <i class="icon-question-sign icon-white"></i> <a href="#">帮助</a> <i class="icon-off icon-white"></i> <a id="modal-973558" href="#modal-container-973558" role="button" data-toggle="modal">注销</a> <i class="icon-user icon-white"></i> <a href="#">开票员的工作平台</a> <i class="icon-envelope icon-white"></i> <a href="#">发送短信</a>
                <div id="modal-container-973558" class="modal hide fade" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" style="width:300px; margin-left:-150px; top:30%">
				<div class="modal-header">
					 <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
					<h3 id="myModalLabel">
						注销系统
					</h3>
				</div>
				<div class="modal-body">
					<p>
						您确定要注销退出系统吗？
					</p>
				</div>
				<div class="modal-footer">
					 <button class="btn" data-dismiss="modal" aria-hidden="true">关闭</button> <a class="btn btn-primary" style="line-height:20px;" href="login.html" >确定退出</a>
				</div>
			</div>
				</div>
</div>
<!-- 顶部 -->     
            
<div id="middle">
     <div class="left">
     
     <script type="text/javascript">
var myMenu;
window.onload = function() {
	myMenu = new SDMenu("my_menu");
	myMenu.init();
};
</script>

		 <div>
			 <span>用户管理</span>
			 <a id="11" href="searchAndDelete.html">查询/删除用户</a>
			 <a id="12" href="addAndEditUser.html">增加/编辑用户</a>
		 </div>
		 <div class="collapsed">
			 <span>营业网点查询</span>
			 <a id="21" href="singleSearch.html">单个网点查询</a>
		 </div>
		 <div class="collapsed">
			 <span>快件管理</span>
			 <a id="31" href="expressDetail.html.html">快件详细信息查询</a>
			 <a id="32" href="expressTransList.html">快件转运列表追踪</a>
			 <a id="33" href="expressTransList.html">快件转运地图追踪</a>
		 </div>

		 <div class="collapsed">
			 <span>包裹管理</span>
			 <a id="41" href="packageSearch.html">包裹单查询</a>
			 <a id="42" href="productPackage.html.html">生成包裹单</a>
		 </div>
		 <div class="collapsed">
			 <span>任务分配</span>
			 <a id="51" href="transTask.html">转运任务分配</a>
			 <a id="52" href="deliverTask.html">派送任务分配</a>
		 </div>
	 </div>
     </div>
     <div class="Switch"></div>
     <script type="text/javascript">
	$(document).ready(function(e) {
    $(".Switch").click(function(){
	$(".left").toggle();
	 
		});
});
</script>

     <div class="right"  id="mainFrame">
     
     <div class="right_cont">
<ul class="breadcrumb">当前位置：
  <a href="#">任务分配</a> <span class="divider">/</span>
  派送任务分配
</ul>
		   <div style="width:900px; margin:auto">
	   </br>

	    <table  class="table table-bordered">
		<!--一条直线-->
		<td onclick="monixianshifenpei()" align="center" nowrap="nowrap" bgcolor="#f1f1f1"><strong id="number">派送任务分配</strong></td>
		</table> 
 </br>
 
       <table class="table table-bordered">
		<tr>
		<td width="12%" align="center" bgcolor="#f1f1f1">快件单号：</td>
		<td width="21%"><input type="text" style="width:300px" name="input18" id="002" width="200"  /></td>
		<td width="12%" align="center" bgcolor="#f1f1f1">派送员ID：</td>
		<td width="21%"><input type="text" style="width:300px" name="input18" id="003" width="200" /></td>
		</tr>
       </table>
	   </br>
		<table  class="margin-bottom-20 table  no-border" >
        <tr><td class="text-center"><input id="fenpeibtn" onclick="FenpeiPaisong()" type="button" value="确认分配" class="btn btn-info " style="width:80px;" /></td></tr>
		</table>
		
		
		<table  class="table table-bordered">
		<!--一条直线-->
		<td align="center" nowrap="nowrap" bgcolor="#f1f1f1"><strong id="number">可派送快件列表（本网点）</strong></td>
		</table> 
		
	    <table id="KepaisongKuaijian" class="table table-bordered">
         <tr>
           <td align="center" nowrap="nowrap" bgcolor="#f1f1f1"><strong>快件ID</strong></td>
           <td align="center" nowrap="nowrap" bgcolor="#f1f1f1"><strong>收件人</strong></td>
           <td align="center" nowrap="nowrap" bgcolor="#f1f1f1"><strong>收件人地址</strong></td>
           <td align="center" nowrap="nowrap" bgcolor="#f1f1f1"><strong>状态</strong></td>
         </tr>
		 <tr>
			<td align="center">X</td>
			<td align="center"></td>
			<td align="center"></td>
			<td align="center"></td>
		 </tr>
		 <table>
</div>
  
     </div>     
     </div>
    </div>
    
<!-- 底部 -->
<div id="footer">版权所有：晶科客流 &copy; 2015&nbsp;&nbsp;&nbsp;&nbsp;服务热线：0371-88888888</div>
    
    

 <script>
!function(){
laydate.skin('molv');
laydate({elem: '#Calendar'});
}();

function monixianshifenpei(){
	var r = [{"ID":"001","name":"李智慧","address":"河南省郑州市中原区郑州大学新校区"},
			{"ID":"002","name":"王平乐","address":"河南省郑州市中原区郑州大学新校区"},
			{"ID":"003","name":"张晓梅","address":"河南省郑州市中原区郑州大学新校区"},
			{"ID":"004","name":"孙志方","address":"河南省郑州市中原区河南工业大学"},
			{"ID":"005","name":"胡邦耀","address":"河南省郑州市中原区郑州大学新校区"},
			{"ID":"006","name":"元中豪","address":"河南省郑州市中原区郑州轻工业学院"},
			{"ID":"007","name":"孙红雷","address":"河南省郑州市中原区郑锅股份"},];
	
					var i = 0;
					var o =          
						'<tr>'+
						'<td align="center" nowrap="nowrap" bgcolor="#f1f1f1"><strong>快件ID</strong></td>'+
						'<td align="center" nowrap="nowrap" bgcolor="#f1f1f1"><strong>收件人</strong></td>'+
						'<td align="center" nowrap="nowrap" bgcolor="#f1f1f1"><strong>收件人地址</strong></td>'+
						'<td align="center" nowrap="nowrap" bgcolor="#f1f1f1"><strong>状态</strong></td>'+
						'</tr>';
						//alert(WangdianPackageID);
					while(i<r.length)
					{
						o = o + 
							'<tr>'+
							'<td align="center">'+r[i].ID+'</td>'+
							'<td align="center">'+r[i].name+'</td>'+
							'<td align="center">'+r[i].address+'</td>'+
							'<td align="center">'+'可派送'+'</td>'+
							'</tr>';
							i=i+1;
					}
					//alert(o);
					$("#KepaisongKuaijian").html("");
					$("#KepaisongKuaijian").append(o);
}
 
function FenpeiPaisong(){
	//var wangdianid = $("#001").val();
	var kuaijianid= $("#002").val();
	var paisongyuanid = $("#003").val();
	if(kuaijianid=="" || paisongyuanid=="" ){
		alert("输入框不能为空！");
	}
	else{
		$.ajax({//外部ajax根据派送员ID 查 他的固定包裹ID,因为打包操作需要（PackageID+快件ID）
			url:"http://localhost:8088/TestCxfHibernate/REST/Domain/getUserList/UID/eq/"+paisongyuanid,
			//url:"http://192.168.43.33:8888/TestCxfHibernate/REST/Domain/getUserList/UID/eq/"+paisongyuanid,
			type:'GET',
			dataType:'json',
			success:function(r){
				//("获取派送员信息成功！");
				var zhuanyunyuanpackageid = r[0].delivePackageID;
				alert("派送员ID:"+paisongyuanid+"  快件ID:"+kuaijianid+" 转运员包裹ID:"+zhuanyunyuanpackageid);
				//alert("转运员包裹ID:"+zhuanyunyuanpackageid);
					$.ajax({
						url:"http://localhost:8088/TestCxfHibernate/REST/Misc/appointDeliver/"+zhuanyunyuanpackageid+"/"+kuaijianid,
						//url:"http://192.168.43.77:8080/TestCxfHibernate/REST/Misc/appointDeliver/"+zhuanyunyuanpackageid+"/"+kuaijianid,
						type:'GET',
						dataType:'json',
						success:function(r){
							alert("分配中......");
							alert("分配成功！");
						},
						error:function(){
							alert("分配失败！");
						}
					});//ajax				
				
			},
			error:function(){
				alert("获取派送员信息失败！");
			}
		});//ajax
		

	}
} 

//获取可派送快件列表
function getKepaisongKuaijian(WangdianPackageID){
			//alert(WangdianPackageID);
			$.ajax({
			
				//url:"http://192.168.43.77:8080/TestCxfHibernate/REST/Domain/getExpressListInPackage/PackageId/"+WangdianPackageID+"?_type=json",
				url:"http://localhost:8088/TestCxfHibernate/REST/Domain/getExpressListInPackage/PackageId/"+WangdianPackageID+"?_type=json",
				type:'GET',
				dataType:'json',
				success:function(r){
				if(r.length==0){
					alert("【当前网点无可派送快件】");
				}else{
					alert("【成功获取该网点可派送的快件】");
				}
				
					var i = 0;
					var o =          
						'<tr>'+
						'<td align="center" nowrap="nowrap" bgcolor="#f1f1f1"><strong>快件ID</strong></td>'+
						'<td align="center" nowrap="nowrap" bgcolor="#f1f1f1"><strong>收件人</strong></td>'+
						'<td align="center" nowrap="nowrap" bgcolor="#f1f1f1"><strong>收件人地址</strong></td>'+
						'<td align="center" nowrap="nowrap" bgcolor="#f1f1f1"><strong>状态</strong></td>'+
						'</tr>';
						//alert(WangdianPackageID);
					while(i<r.length)
					{
						o = o + 
							'<tr>'+
							'<td align="center">'+r[i].ID+'</td>'+
							'<td align="center">'+r[i].recever.name+'</td>'+
							'<td align="center">'+r[i].recever.address+'</td>'+
							'<td align="center">'+'可派送'+'</td>'+
							'</tr>';
							i=i+1;
					}
					//alert(o);
					$("#KepaisongKuaijian").html("");
					$("#KepaisongKuaijian").append(o);
					//alert(o);
				},
				error:function(){
					alert("【获取数据失败！】");
				}
			});//ajax
}

function GetQueryString(name) {
    var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)");
    var r = window.location.search.substr(1).match(reg);
    if (r != null) return unescape(r[2]); return null;
}
var canshu = GetQueryString("NowUserId");
$("#11").attr("href","searchAndDelete.html?NowUserId="+canshu);
$("#12").attr("href","addAndEditUser?NowUserId="+canshu);
$("#21").attr("href","singleSearch.html?NowUserId="+canshu);
$("#31").attr("href","expressDetail.html?NowUserId="+canshu);
$("#32").attr("href","expressTransList.html.html?NowUserId="+canshu);
$("#33").attr("href","expressTransList.html?NowUserId="+canshu);
$("#41").attr("href","packageSearch.html?NowUserId="+canshu);
$("#42").attr("href","productPackage.html.html?NowUserId="+canshu);
$("#51").attr("href","transTask.html?NowUserId="+canshu);
$("#52").attr("href","deliverTask.html?NowUserId="+canshu);
$(function(){
	//var wangdianid = $("#wangdianid").val();
	//var wangdianid="420106";              //实际上也是网点包裹ID
	//alert("");
	var wangdianid = canshu;
	getKepaisongKuaijian(wangdianid);
});
</script>



 
</body>
</html>
