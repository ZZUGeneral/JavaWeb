<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>卓越物流管理系统</title>
<link rel="stylesheet" href="css/bootstrap.css" />
<link rel="stylesheet" href="css/css.css" />
<script type="text/javascript" src="js/jquery1.9.0.min.js"></script>
<script type="text/javascript" src="js/bootstrap.min.js"></script>
<script type="text/javascript" src="js/sdmenu.js"></script>
<script type="text/javascript" src="js/laydate/laydate.js"></script>

</head>

<body>
<div class="header">
	 <div class="logo"><img  src="img/网站大标题0.png" /></div>
     
				<div class="header-right">
                <i class="icon-question-sign icon-white"></i> <a href="#">帮助</a> <i class="icon-off icon-white"></i> <a id="modal-973558" href="#modal-container-973558" role="button" data-toggle="modal">注销</a> <i class="icon-user icon-white"></i> <a href="#">管理员的工作平台</a> <i class="icon-envelope icon-white"></i> <a href="#">发送短信</a>
                <div id="modal-container-973558" class="modal hide fade" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" style="width:300px; margin-left:-150px; top:30%">
				<div class="modal-header">
					 <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
					<h3 id="myModalLabel">
						注销系统
					</h3>
				</div>
				<div class="modal-body">
					<p>
						您确定要注销退出系统吗？
					</p>
				</div>
				<div class="modal-footer">
					 <button class="btn" data-dismiss="modal" aria-hidden="true">关闭</button> <a class="btn btn-primary" style="line-height:20px;" href="login.html" >确定退出</a>
				</div>
			</div>
				</div>
</div>
<!-- 顶部 -->     
            
<div id="middle">
     <div class="left">
     
     <script type="text/javascript">
var myMenu;
window.onload = function() {
	myMenu = new SDMenu("my_menu");
	myMenu.init();
};
</script>

		 <div id="my_menu" class="sdmenu">
			 <div>
				 <span>用户管理</span>
				 <a id="11" href="searchAndDelete.html">查询/删除用户</a>
				 <a id="12" href="addAndEditUser.html">增加/编辑用户</a>
			 </div>
			 <div class="collapsed">
				 <span>营业网点查询</span>
				 <a id="21" href="singleSearch.html">单个网点查询</a>
			 </div>
			 <div class="collapsed">
				 <span>快件管理</span>
				 <a id="31" href="expressDetail.html.html">快件详细信息查询</a>
				 <a id="32" href="expressTransList.html">快件转运列表追踪</a>
				 <a id="33" href="expressTransList.html">快件转运地图追踪</a>
			 </div>

			 <div class="collapsed">
				 <span>包裹管理</span>
				 <a id="41" href="packageSearch.html">包裹单查询</a>
				 <a id="42" href="productPackage.html.html">生成包裹单</a>
			 </div>
			 <div class="collapsed">
				 <span>任务分配</span>
				 <a id="51" href="transTask.html">转运任务分配</a>
				 <a id="52" href="deliverTask.html">派送任务分配</a>
			 </div>
		 </div>
     </div>
     <div class="Switch"></div>
     <script type="text/javascript">
	$(document).ready(function(e) {
    $(".Switch").click(function(){
	$(".left").toggle();
	 
		});
});
</script>

     <div class="right"  id="mainFrame">
     
     <div class="right_cont">
<ul class="breadcrumb">当前位置：
  <a href="#">快件管理</a> <span class="divider">/</span>
  快件转运列表追踪
</ul>
   <div class="title_right"><strong>快件转运列表追踪</strong></div>  
   <div style="width:900px; margin:auto">
   
       <table class="table table-bordered">
		<tr>
		<td  align="center" bgcolor="#f1f1f1">快件单号：</td>
		<td width="60%" ><input type="text" name="input18" id="001" style="width:600px"  /></td>
		</tr>
       </table>
       <table  class="margin-bottom-20 table  no-border" >
        <tr>
     	<td class="text-center"><input type="button" onclick="MoniGetHistory()" value="查询" class="btn btn-info " style="width:80px;" /></td>
     </tr>
 </table>
 
 
<table  class="table table-bordered" >
       
</table>


       <table id="kuaijianlishi" class="table table-bordered">
         <tr>
           <td align="center" nowrap="nowrap" bgcolor="#f1f1f1"><strong>时间</strong></td>
           <td align="center" nowrap="nowrap" bgcolor="#f1f1f1"><strong>出发地</strong></td>
           <td align="center" nowrap="nowrap" bgcolor="#f1f1f1"><strong>目的地</strong></td>
           <td align="center" nowrap="nowrap" bgcolor="#f1f1f1"><strong>状态</strong></td>
          </tr>
		  <tr>
           <td align="center" >暂无数据</td>
		   <td align="center" >暂无数据</td>
		   <td align="center" >暂无数据</td>
		   <td align="center" >暂无数据</td>
          </tr>
		  <tr>
           <td align="center" >暂无数据</td>
		   <td align="center" >暂无数据</td>
		   <td align="center" >暂无数据</td>
		   <td align="center" >暂无数据</td>
          </tr>
       </table>
      

   <table  class="margin-bottom-20 table  no-border" >
     <tr>
       <td class="text-center"><input type="button" value="打印" class="btn btn-info  margin-right-20" style="width:80px;" /><input type="button" value="数据导出" class="btn btn-info  " style="width:80px;" /></td>
     </tr>
   </table>
</div>
     
     
     </div>     
     </div>
    </div>
    
<!-- 底部 -->
<div id="footer">版权所有：晶科客流 &copy; 2015&nbsp;&nbsp;&nbsp;&nbsp;服务热线：0371-88888888</div>
    
    

 <script>
!function(){
laydate.skin('molv');
laydate({elem: '#Calendar'});
}();

function GetQueryString(name) {
    var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)");
    var r = window.location.search.substr(1).match(reg);
    if (r != null) return unescape(r[2]); return null;
}


var canshu = GetQueryString("NowUserId");
$("#11").attr("href","searchAndDelete.html?NowUserId="+canshu);
$("#12").attr("href","addAndEditUser?NowUserId="+canshu);
$("#21").attr("href","singleSearch.html?NowUserId="+canshu);
$("#31").attr("href","expressDetail.html?NowUserId="+canshu);
$("#32").attr("href","expressTransList.html.html?NowUserId="+canshu);
$("#33").attr("href","expressTransList.html?NowUserId="+canshu);
$("#41").attr("href","packageSearch.html?NowUserId="+canshu);
$("#42").attr("href","productPackage.html.html?NowUserId="+canshu);
$("#51").attr("href","transTask.html?NowUserId="+canshu);
$("#52").attr("href","deliverTask.html?NowUserId="+canshu);

function MoniGetHistory(){
	var r = [{"actTime":"2018-06-25T10:04:06+08:00","packeg":{"ID":"0","sourceNode":"河南省郑州市中原区 郑州大学 柳园","targetNode":"揽收员:User12","status":"0"},"UIDFrom":"0","UIDTo":"0"},
	{"actTime":"2018-06-25T10:04:06+08:00","packeg":{"ID":"0","sourceNode":"河南省 郑州市 中原区","targetNode":"河南省 郑州市 市辖区","status":"0"},"UIDFrom":"0","UIDTo":"0"},
	{"actTime":"2018-06-25T10:04:06+08:00","packeg":{"ID":"0","sourceNode":"河南省 郑州市 市辖区","targetNode":"湖北省 武汉市 市辖区","status":"0"},"UIDFrom":"0","UIDTo":"0"},
	{"actTime":"2018-06-25T10:04:06+08:00","packeg":{"ID":"0","sourceNode":"湖北省 武汉市 市辖区","targetNode":"湖北省 武汉市 武昌区","status":"0"},"UIDFrom":"0","UIDTo":"0"},
	{"actTime":"2018-06-25T10:04:06+08:00","packeg":{"ID":"0","sourceNode":"湖北省 武汉市 武昌区","targetNode":"派送员:User13","status":"0"},"UIDFrom":"0","UIDTo":"0"},
	{"actTime":"2018-06-25T10:04:06+08:00","packeg":{"ID":"0","sourceNode":"派送员:User13","targetNode":"湖北省武汉市武昌区 武汉大学 樱园","status":"0"},"UIDFrom":"0","UIDTo":"0"}];
	
	var i =1;
	var m = r.length;
	var o = '<tr>'+
			'<td align="center" nowrap="nowrap" bgcolor="#f1f1f1"><strong>时间</strong></td>'+
			'<td align="center" nowrap="nowrap" bgcolor="#f1f1f1"><strong>出发地</strong></td>'+
			'<td align="center" nowrap="nowrap" bgcolor="#f1f1f1"><strong>目的地</strong></td>'+
			'<td align="center" nowrap="nowrap" bgcolor="#f1f1f1"><strong>状态</strong></td>'+
			'</tr>';
			o=o+'<tr>'+
			'<td align="center" >'+r[0].actTime+'</td>'+
			'<td align="center" >'+r[0].packeg.sourceNode+'</td>'+
			'<td align="center" >'+r[0].packeg.targetNode+'</td>'+
			'<td align="center" >'+'已揽收'+'</td>'+
			'</tr>';		
	
	while(i<m-2){
		o=o+'<tr>'+
			'<td align="center" >'+r[i].actTime+'</td>'+
			'<td align="center" >'+r[i].packeg.sourceNode+'</td>'+
			'<td align="center" >'+r[i].packeg.targetNode+'</td>'+
			'<td align="center" >'+'分拣/运输'+'</td>'+
			'</tr>';
		i=i+1;
	}
			o=o+'<tr>'+
			'<td align="center" >'+r[m-2].actTime+'</td>'+
			'<td align="center" >'+r[m-2].packeg.sourceNode+'</td>'+
			'<td align="center" >'+r[m-2].packeg.targetNode+'</td>'+
			'<td align="center" >'+'正在派送'+'</td>'+
			'</tr>';
			o=o+'<tr>'+
			'<td align="center" >'+r[m-1].actTime+'</td>'+
			'<td align="center" >'+r[m-1].packeg.sourceNode+'</td>'+
			'<td align="center" >'+r[m-1].packeg.targetNode+'</td>'+
			'<td align="center" >'+'已签收'+'</td>'+
			'</tr>';
			
			$("#kuaijianlishi").html("");
			$("#kuaijianlishi").html(o);
	
	
}
 
 
function GetLishi(){

//获取查询条件的值  根据参数的不同选择方法
		var id =           $("#001").val();
        //var sendertel =    $("#002").val();
        //var receivertel =  $("#003").val();
		if(id==""){
			alert("查询条件不能为空！");
		}
			//alert("查询条件不能为空！");
		if(id != ""){
			var ExpressID =id;//！！！！！
			alert(id);
		}
		/*else{
			if(sendertel!= ""){
				var condition = sendertel;
				var f = "getExpressListBySndTel";//原因不明
				alert(typeof(condition)+condition);
			}
			else{
				var condition = receivertel;
				var f = "getExpressListByRecTel";//原因不明
				alert(typeof(condition)+condition);
			}
		}*/
//这里无错
	$.ajax({

		url:"http://localhost:8088/TestCxfHibernate/REST/Misc/getTransHistory/"+ExpressID+"?_type=json",//获取N条记录list
		type:'GET',
		dataType:'json',
		success:function(r) {
			
	var m = r.length;
	//var m = r.length-1;
	var i = m-2;
	console.log(m);
	var o = '<tr>'+
			'<td align="center" nowrap="nowrap" bgcolor="#f1f1f1"><strong>时间</strong></td>'+
			'<td align="center" nowrap="nowrap" bgcolor="#f1f1f1"><strong>出发地</strong></td>'+
			'<td align="center" nowrap="nowrap" bgcolor="#f1f1f1"><strong>目的地</strong></td>'+
			'<td align="center" nowrap="nowrap" bgcolor="#f1f1f1"><strong>状态</strong></td>'+
			'</tr>';
			o=o+'<tr>'+
			'<td align="center" >'+r[m-1].actTime+'</td>'+
			'<td align="center" >'+r[m-1].packeg.sourceNode+'</td>'+
			'<td align="center" >'+r[m-1].packeg.targetNode+'</td>'+
			'<td align="center" >'+'已揽收'+'</td>'+
			'</tr>';		
	
	while(i>1){
		o=o+'<tr>'+
			'<td align="center" >'+r[i].actTime+'</td>'+
			'<td align="center" >'+r[i].packeg.sourceNode+'</td>'+
			'<td align="center" >'+r[i].packeg.targetNode+'</td>'+
			'<td align="center" >'+'分拣/运输'+'</td>'+
			'</tr>';
		i=i-1;
	}
			o=o+'<tr>'+
			'<td align="center" >'+r[1].actTime+'</td>'+
			'<td align="center" >'+r[1].packeg.sourceNode+'</td>'+
			'<td align="center" >'+r[1].packeg.targetNode+'</td>'+
			'<td align="center" >'+'分拣/运输'+'</td>'+
			'</tr>';
			o=o+'<tr>'+
			'<td align="center" >'+r[0].actTime+'</td>'+
			'<td align="center" >'+r[0].packeg.sourceNode+'</td>'+
			'<td align="center" >'+r[0].packeg.targetNode+'</td>'+
			'<td align="center" >'+'分拣/运输'+'</td>'+
			'</tr>';

			$("#kuaijianlishi").html("");
			$("#kuaijianlishi").html(o);
			
			if(r[0].packeg.status==-1)
			{	
				//$(":last")
				//alert($("#kuaijianlishi").children("tr:last-child").html());
				//.children("input:last-child").text());
				//alert();
				$('#kuaijianlishi tr:last').find('td:last').text('已签收');
				var a = $('#kuaijianlishi tr:last').find('td:last').prev().text();
				var b = $('#kuaijianlishi tr:last').find('td:last').prev().prev().text();
				//$('#kuaijianlishi tr:last').find('td:last').text('已签收');
				$('#kuaijianlishi tr:last').find('td:last').prev().text(b);
				$('#kuaijianlishi tr:last').find('td:last').prev().prev().text(a);
				//alert($("#kuaijianlishi").children("tr:last-child").children("td:last-child").text());
				//$("#kuaijianlishi").children("input:last-child").children("input:last-child").text("已签收");prev().text("正在派送");
				alert("--------");
			}
			
			},//success
			error:function (XMLHttpRequest, textStatus, errorThrown){
				alert("未查询到数据！");
			}
		
		});				
}
</script>
</body>
</html>
