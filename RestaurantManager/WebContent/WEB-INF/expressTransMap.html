<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
<title>卓越物流管理系统</title>
<link rel="stylesheet" href="css/bootstrap.css" />
<link rel="stylesheet" href="css/css.css" />
<script type="text/javascript" src="js/jquery1.9.0.min.js"></script>
<script type="text/javascript" src="js/bootstrap.min.js"></script>
<script type="text/javascript" src="js/sdmenu.js"></script>
<script type="text/javascript" src="js/laydate/laydate.js"></script>

<!--百度地图API-->
<script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&ak=8nTRAKtZXD0wQ1tzTpcT7lcV1tzgKYTx"></script>
<style>
<!--#allmap{height:500px;width:100%;}-->
#r-result{width:100%; font-size:14px;}

#allmap {height:500px;width:100%;overflow: hidden;margin:0;font-family:"微软雅黑";}
.div1
{
	width:900px;
	height:500px;
	border:5px solid black;
}
</style>
</head>
<!--#BA55D3-->
<body>
<div class="header">
	 <div class="logo"><img  src="img/网站大标题0.png" /></div>
     
				<div class="header-right">
                <i class="icon-question-sign icon-white"></i> <a href="#">帮助</a> <i class="icon-off icon-white"></i> <a id="modal-973558" href="#modal-container-973558" role="button" data-toggle="modal">注销</a> <i class="icon-user icon-white"></i> <a href="#">管理员的工作平台</a> <i class="icon-envelope icon-white"></i> <a href="#">发送短信</a>
                <div id="modal-container-973558" class="modal hide fade" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" style="width:300px; margin-left:-150px; top:30%">
				<div class="modal-header">
					 <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
					<h3 id="myModalLabel">
						注销系统
					</h3>
				</div>
				<div class="modal-body">
					<p>
						您确定要注销退出系统吗？
					</p>
				</div>
				<div class="modal-footer">
					 <button class="btn" data-dismiss="modal" aria-hidden="true">关闭</button> <a class="btn btn-primary" style="line-height:20px;" href="login.html" >确定退出</a>
				</div>
			</div>
				</div>
</div>
<!-- 顶部 -->     
            
<div id="middle">
     <div class="left">
     
     <script type="text/javascript">
var myMenu;
window.onload = function() {
	myMenu = new SDMenu("my_menu");
	myMenu.init();
};
</script>

		 <div id="my_menu" class="sdmenu">
			 <div>
				 <span>用户管理</span>
				 <a id="11" href="searchAndDelete.html">查询/删除用户</a>
				 <a id="12" href="addAndEditUser.html">增加/编辑用户</a>
			 </div>
			 <div class="collapsed">
				 <span>营业网点查询</span>
				 <a id="21" href="singleSearch.html">单个网点查询</a>
			 </div>
			 <div class="collapsed">
				 <span>快件管理</span>
				 <a id="31" href="expressDetail.html.html">快件详细信息查询</a>
				 <a id="32" href="expressTransList.html">快件转运列表追踪</a>
				 <a id="33" href="expressTransList.html">快件转运地图追踪</a>
			 </div>

			 <div class="collapsed">
				 <span>包裹管理</span>
				 <a id="41" href="packageSearch.html">包裹单查询</a>
				 <a id="42" href="productPackage.html.html">生成包裹单</a>
			 </div>
			 <div class="collapsed">
				 <span>任务分配</span>
				 <a id="51" href="transTask.html">转运任务分配</a>
				 <a id="52" href="deliverTask.html">派送任务分配</a>
			 </div>
		 </div>
     </div>
     <div class="Switch"></div>
     <script type="text/javascript">
	$(document).ready(function(e) {
    $(".Switch").click(function(){
	$(".left").toggle();
	 
		});
});
</script>

     <div class="right"  id="mainFrame">
     
     <div class="right_cont">
<ul class="breadcrumb">当前位置：
  <a href="#">快件管理</a> <span class="divider">/</span>
  快件转运地图追踪
</ul>
   <div class="title_right"><strong>快件转运地图追踪</strong></div>  
   <div style="width:900px; margin:auto" align="center">
       <table class="table table-bordered">
		<tr>
		<td  align="center" bgcolor="#f1f1f1">快件单号：</td>
		<td width="60%" ><input type="text" name="input18" id="kuaijianID" style="width:600px"  /></td>
		</tr>
       </table>
       <table  class="margin-bottom-20 table  no-border" >
        <tr>
     	<td  class="text-center"><input type="button" onclick="GetTrace()" value="查询" class="btn btn-info " style="width:80px;" /></td>
		<td  class="text-center"><input type="button" onclick="DrawTrace()" value="预期效果" class="btn btn-info " style="width:80px;" /></td>
     </tr>
 </table>
 
 
<table  class="table table-bordered" >
       
</table>

<div id="allmap" class="div1"></div>

<table  class="table table-bordered" >
       
</table>
 
</div>
     
     
     </div>     
     </div>
    </div>
    
<!-- 底部 -->
<div id="footer">版权所有：晶科客流 &copy; 2015&nbsp;&nbsp;&nbsp;&nbsp;服务热线：0371-88888888</div>
    
    

 <script>
!function(){
laydate.skin('molv');
laydate({elem: '#Calendar'});
}();
 
</script>



 
</body>
</html>
<script type="text/javascript">

function GetTrace(){
	var expressID = $("#kuaijianID").val();
	$.ajax({	
				url:'http://localhost:8088/TestCxfHibernate/REST/Misc/getPackageRoute/'+expressID+'?_type=json',
				//url:'http://localhost:8088/TomcatTest/ExtracePoint.xml?_type=json',
				type:'get',
				//data:{"flag":1},
				//dataType:"json",
				success:function(r){
					
					alert("获取Point成功");
					
var m = r.length;
map.centerAndZoom(new BMap.Point(r[m-1].y, r[m-1].x), 6); //设置目的地为中心城市
var icons = new BMap.IconSequence(sy, '10', '30');
var points = [];//数组 存放N个点
					
					
			var i = 0;
			while(i<r.length){
			console.log(r);
			
				x=r[i].y;
				y=r[i].x;
				points.push(new BMap.Point(x,y)); 
				i=i+1;
			}
			
			var polyline =new BMap.Polyline(points, {
   enableEditing: false,//是否启用线编辑，默认为false
   enableClicking: true,//是否响应点击事件，默认为true
   icons:[icons],
   strokeWeight:'8',//折线的宽度，以像素为单位
   strokeOpacity: 0.8,//折线的透明度，取值范围0 - 1
   strokeColor:"#18a45b" //折线颜色
});
map.addOverlay(polyline);          //增加折线
			
			
			
				},//success
				error:function(){
					alert("获取Point失败");
				}
	});//ajax
}

function GetQueryString(name) {
    var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)");
    var r = window.location.search.substr(1).match(reg);
    if (r != null) return unescape(r[2]); return null;
}
var canshu = GetQueryString("NowUserId");
$("#11").attr("href","searchAndDelete.html?NowUserId="+canshu);
$("#12").attr("href","addAndEditUser?NowUserId="+canshu);
$("#21").attr("href","singleSearch.html?NowUserId="+canshu);
$("#31").attr("href","expressDetail.html?NowUserId="+canshu);
$("#32").attr("href","expressTransList.html.html?NowUserId="+canshu);
$("#33").attr("href","expressTransList.html?NowUserId="+canshu);
$("#41").attr("href","packageSearch.html?NowUserId="+canshu);
$("#42").attr("href","productPackage.html.html?NowUserId="+canshu);
$("#51").attr("href","transTask.html?NowUserId="+canshu);
$("#52").attr("href","deliverTask.html?NowUserId="+canshu);

// 百度地图API功能
var map = new BMap.Map("allmap");    // 创建Map实例
var top_left_control = new BMap.ScaleControl({anchor: BMAP_ANCHOR_TOP_LEFT});// 左上角，添加比例尺
var top_left_navigation = new BMap.NavigationControl();  //左上角，添加默认缩放平移控件
var top_right_navigation = new BMap.NavigationControl({anchor: BMAP_ANCHOR_TOP_RIGHT, type: BMAP_NAVIGATION_CONTROL_SMALL}); //右上角，仅包含平移和缩放按钮
map.addControl(top_left_control);        
map.addControl(top_left_navigation);     
map.addControl(top_right_navigation);
map.centerAndZoom(new BMap.Point(113.649, 34.756), 6);  // 数字大=精确度高 初始化地图,设置中心点坐标和地图级别
map.enableScrollWheelZoom(true);     //开启鼠标滚轮缩放
var sy = new BMap.Symbol(BMap_Symbol_SHAPE_BACKWARD_OPEN_ARROW, {
    scale: 0.6,//图标缩放大小
    strokeColor:'#fff',//设置矢量图标的线填充颜色
    strokeWeight: '2',//设置线宽
});

function DrawTrace(){

var r = [{"x":"113.649","y":"34.756"}, //郑州
		{"x":"113.835","y":"34.026"},  //许昌
		{"x":"114.046","y":"33.576"}, //漯河
		{"x":"114.049","y":"32.983"}, //驻马店
		{"x":"114.316","y":"30.581"},//武汉
		];
var m = r.length;
map.centerAndZoom(new BMap.Point(r[m-1].x, r[m-1].y), 6); //设置目的地为中心城市
var icons = new BMap.IconSequence(sy, '10', '30');
var points = [];//数组 存放N个点

// 创建polyline对象
			var i = 0;
			while(i<r.length){
			console.log(r);
			
				x=r[i].x;
				y=r[i].y;
				points.push(new BMap.Point(x,y)); 
				i=i+1;
			}

/*var pois = [
		new BMap.Point(113.649, 34.756),	//郑州
		new BMap.Point(114.316, 30.581),	//武汉
		new BMap.Point(112.979, 28.213),	//长沙
		new BMap.Point(113.307, 23.120),	//广州
		new BMap.Point(114.025, 22.546)		//深圳
];*/
var polyline =new BMap.Polyline(points, {
   enableEditing: false,//是否启用线编辑，默认为false
   enableClicking: true,//是否响应点击事件，默认为true
   icons:[icons],
   strokeWeight:'8',//折线的宽度，以像素为单位
   strokeOpacity: 0.8,//折线的透明度，取值范围0 - 1
   strokeColor:"#18a45b" //折线颜色
});
map.addOverlay(polyline);          //增加折线
}




  
</script>